intel-sgx
=========
This feature adds Linux driver support for Intel Software Guard
Extensions (SGX) in intel-x86 BSP.

To enable this feature, please add the following configuration parameter:

    --template=feature/intel-sgx

In order to make SGX work on your platform, you need SGX Linux driver,
SGX SDK, SGX PSW (platform software) and enable SGX in BIOS.

Currently, SGX SDK and SGX PSW can only be built on target. Here are the steps.

1) On target:

    Install dependent packages ocaml and ocamlbuild.
    $ wget https://github.com/ocaml/ocaml/archive/refs/tags/4.13.1.tar.gz
    $ tar -zxf 4.13.1.tar.gz
    $ cd ocaml-4.13.1
    $ ./configure
    $ make world.opt
    $ make install

    $ wget https://github.com/ocaml/ocamlbuild/archive/refs/tags/0.14.2.tar.gz
    $ tar -zxf 0.14.2.tar.gz
    $ cd ocamlbuild-0.14.2
    $ make
    $ make install

    $ wget https://github.com/protocolbuffers/protobuf/archive/refs/tags/v3.21.12.tar.gz
    $ tar -zxf v3.21.12.tar.gz
    $ cd protobuf-3.21.12
    $ ./autogen.sh
    $ ./configure
    $ make
    $ make install

    Clone linux-sgx.
    $ git clone https://github.com/intel/linux-sgx.git

    $ cd linux-sgx/
    $ git reset --hard c1ceb4fe146e0feb1097dee81c7e89925443e43c

    You may change "wget" to "wget --no-check-certificate" depending on your network settings.

    $ make preparation
    $ ln -s /usr/bin/python3 /usr/bin/python

    Generate SDK Install package.
    $ make sdk_install_pkg

    Install SGX SDK to "/opt/intel".
    $ ./linux/installer/bin/sgx_linux_x64_sdk_2.24.100.3.bin
      Do you want to install in current directory? [yes/no] : no
      Please input the directory which you want to install in : /opt/intel

    $ make psw_install_pkg

    Install SGX PSW.
    $ ./linux/installer/bin/sgx_linux_x64_psw_2.24.100.3.bin

2) Reboot target.

3) Check Intel architectural enclave service manager.

    $ systemctl status aesmd.service

4) You can build and run samples in /opt/intel/sgxsdk/SampleCode. For example:

    $ cd /opt/intel/sgxsdk/SampleCode/SampleEnclave
    $ make
    $ ./app
      Checksum(0x0x7ffed440cca0, 100) = 0xfffd4143
      Info: executing thread synchronization, please wait...
      Info: SampleEnclave successfully returned.
      Enter a character before exit ...

#@TYPE: Wrtemplate
#@NAME: intel-sgx
#@DESCRIPTION: Add sgx drivers to the image
